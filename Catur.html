<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Catur Online & Lokal</title>
<style>
  body { font-family:sans-serif; text-align:center; background:#f0f0f0; }
  #board { display:grid; grid-template: repeat(8, 50px) / repeat(8, 50px); margin:20px auto; }
  .cell { width:50px; height:50px; display:flex; align-items:center; justify-content:center; }
  .white { background:#eee; }
  .black { background:#666; color:white; }
  button { margin:5px; padding:10px; font-size:16px; }
</style>
</head>
<body>

<h2>Catur</h2>
<button onclick="startLocal()">Main di Satu Perangkat</button>
<button onclick="startOnline()">Main Online</button>

<div id="status"></div>
<div id="board"></div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// ======= FIREBASE CONFIG =======
const firebaseConfig = {
  apiKey: "AIzaSyDkc6U4iRgPCaBA8ckQdn6YX0dh5-uNpTg",
  authDomain: "catur-online-77231.firebaseapp.com",
  databaseURL: "https://catur-online-77231-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "catur-online-77231",
  storageBucket: "catur-online-77231.appspot.com",
  messagingSenderId: "818334923522",
  appId: "1:818334923522:web:b63297ef12e6b879c9201b",
  measurementId: "G-Z95MWVQVXS"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ======= VARIABEL =======
let board = [];
let turn = 'w';
let onlineRoom = null;

// ======= GAMBAR BOARD LOKAL =======
function drawBoard() {
  const b = document.getElementById('board');
  b.innerHTML = '';
  for(let r=0;r<8;r++){
    board[r] = board[r] || [];
    for(let c=0;c<8;c++){
      const cell = document.createElement('div');
      cell.className = 'cell ' + ((r+c)%2===0?'white':'black');
      cell.textContent = board[r][c]||'';
      cell.onclick = ()=>move(r,c);
      b.appendChild(cell);
    }
  }
}

// ======= MODE LOKAL =======
function startLocal(){
  turn = 'w';
  board = [
    ['♜','♞','♝','♛','♚','♝','♞','♜'],
    ['♟','♟','♟','♟','♟','♟','♟','♟'],
    ['','','','','','','',''],
    ['','','','','','','',''],
    ['','','','','','','',''],
    ['','','','','','','',''],
    ['♙','♙','♙','♙','♙','♙','♙','♙'],
    ['♖','♘','♗','♕','♔','♗','♘','♖']
  ];
  document.getElementById('status').textContent = 'Mode Lokal: Putih giliran pertama';
  drawBoard();
}

function move(r,c){
  // Hanya untuk mode lokal
  if(!board[r][c]) return;
  alert('Implementasi langkah bidak lokal bisa dikembangkan');
}

// ======= MODE ONLINE =======
function startOnline(){
  const room = prompt('Masukkan nama room (bebas):');
  if(!room) return;
  onlineRoom = room;
  const roomRef = db.ref('rooms/' + room);
  roomRef.once('value', snapshot=>{
    if(!snapshot.exists()){
      // buat board baru
      roomRef.set({board:initBoard(), turn:'w'});
    }
  });
  // listen update
  roomRef.on('value', snap=>{
    const data = snap.val();
    if(!data) return;
    board = data.board;
    turn = data.turn;
    drawBoard();
    document.getElementById('status').textContent = 'Mode Online: Giliran ' + (turn==='w'?'Putih':'Hitam');
  });
}

function initBoard(){
  return [
    ['♜','♞','♝','♛','♚','♝','♞','♜'],
    ['♟','♟','♟','♟','♟','♟','♟','♟'],
    ['','','','','','','',''],
    ['','','','','','','',''],
    ['','','','','','','',''],
    ['','','','','','','',''],
    ['♙','♙','♙','♙','♙','♙','♙','♙'],
    ['♖','♘','♗','♕','♔','♗','♘','♖']
  ];
}
</script>
</body>
</html>